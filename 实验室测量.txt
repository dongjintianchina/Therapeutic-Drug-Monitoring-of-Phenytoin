WITH 
-- 实验室指标_苯妥英钠
FIRST_phenytoin AS
	 (SELECT DISTINCT ON (LAB.HADM_ID) LAB.HADM_ID,LAB.VALUENUM, LAB.VALUEUOM
	 FROM WORK.KEYAN_ESWOFG_MIMIC_SUBJECT AS SUBJECT,
	 MIMICIV_DERIVED.ICUSTAY_DETAIL AS ICU,
	 MIMICIV_HOSP.LABEVENTS AS LAB
	 WHERE LAB.ITEMID = 50967
	 AND LAB.CHARTTIME >= ICU.ICU_INTIME
	 AND SUBJECT.STAY_ID = ICU.STAY_ID
	 AND SUBJECT.HADM_ID = LAB.HADM_ID
	 ORDER BY LAB.HADM_ID,LAB.CHARTTIME)

SELECT DISTINCT(SUBJECT.SUBJECT_ID),SUBJECT.STAY_ID,SUBJECT.HADM_ID,
	ROUND(FIRST_phenytoin.VALUENUM::numeric,2) AS FIRST_phenytoin,
	FIRST_phenytoin.VALUEUOM AS FIRST_phenytoin_UOM
	FROM WORK.keyan_eswofg_mimic_subject AS SUBJECT
LEFT JOIN FIRST_phenytoin ON SUBJECT.HADM_ID = FIRST_phenytoin.HADM_ID

ORDER BY SUBJECT.SUBJECT_ID